!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@tensorflow/tfjs")):"function"==typeof define&&define.amd?define(["@tensorflow/tfjs"],t):"object"==typeof exports?exports.remoteRequire=t(require("@tensorflow/tfjs")):e.remoteRequire=t(e["@tensorflow/tfjs"])}(window,function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["person","bicycle","car","motorbike","aeroplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","sofa","pottedplant","bed","diningtable","toilet","tvmonitor","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"]},function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.yolo_filter_boxes=t.YOLO_ANCHORS=void 0;var n,o;t.yolo_filter_boxes=(n=regeneratorRuntime.mark(function e(t,r,n,o){var a,u,s,c,l,f,p,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.mul(r,n),u=i.argMax(a,-1),s=i.max(a,-1),c=i.greaterEqual(s,i.scalar(o)),e.next=6,c.data();case 6:for(l=e.sent,f=[],p=0;p<l.length;p++)l[p]&&f.push(p);if(0!=f.length){e.next=11;break}return e.abrupt("return",[null,null,null]);case 11:return d=i.tensor1d(f),e.abrupt("return",[i.gather(t.reshape([l.length,4]),d),i.gather(s.flatten(),d),i.gather(u.flatten(),d)]);case 13:case"end":return e.stop()}},e,this)}),o=function(){var e=n.apply(this,arguments);return new Promise(function(t,r){return function n(o,a){try{var i=e[o](a),u=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});t(u)}("next")})},function(e,t,r,n){return o.apply(this,arguments)});t.yolo_boxes_to_corners=function(e,t){var r=i.tensor1d([2]),n=i.sub(e,i.div(t,r)),o=i.add(e,i.div(t,r)),a=n.shape[0],u=n.shape[1],s=n.shape[2],c=[a,u,s,1];return i.concat([n.slice([0,0,0,1],c),n.slice([0,0,0,0],c),o.slice([0,0,0,1],c),o.slice([0,0,0,0],c)],3)},t.non_max_suppression=function(e,t,r){for(var n=[],o=0;o<t.length;o++)n.push([t[o],[e[4*o],e[4*o+1],e[4*o+2],e[4*o+3]],o]);var a=[];return n.sort(function(e,t){return t[0]-e[0]}).forEach(function(e){for(var t=!0,n=0;n<a.length;n++)if(l(e[1],a[n][1])>r){t=!1;break}t&&a.push(e)}),[a.map(function(e){return e[2]}),a.map(function(e){return e[1]}),a.map(function(e){return e[0]})]},t.yolo_head=function(e,t,r){var n=t.shape[0],o=i.reshape(t,[1,1,n,2]),a=e.shape.slice(1,3),u=a[0],s=a[1],c=i.range(0,a[0]),l=i.range(0,a[1]);c=i.tile(c,[a[1]]),l=i.tile(i.expandDims(l,0),[a[0],1]),l=i.transpose(l).flatten();var f=i.transpose(i.stack([c,l]));f=i.reshape(f,[a[0],a[1],1,2]),f=i.cast(f,e.dtype),e=i.reshape(e,[a[0],a[1],n,r+5]),a=i.cast(i.reshape(i.tensor1d(a),[1,1,1,2]),e.dtype);var p=i.sigmoid(e.slice([0,0,0,0],[u,s,n,2])),d=i.exp(e.slice([0,0,0,2],[u,s,n,2])),h=i.sigmoid(e.slice([0,0,0,4],[u,s,n,1])),b=i.softmax(e.slice([0,0,0,5],[u,s,n,r]));return p=i.div(i.add(p,f),a),d=i.div(i.mul(d,o),a),[p,d,h,b]},t.box_intersection=s,t.box_union=c,t.box_iou=l;var a,i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(1)),u=r(0);(a=u)&&a.__esModule;t.YOLO_ANCHORS=i.tensor2d([[.57273,.677385],[1.87446,2.06253],[3.33843,5.47434],[7.88282,3.52778],[9.77052,9.16828]]);function s(e,t){var r=Math.min(e[3],t[3])-Math.max(e[1],t[1]),n=Math.min(e[2],t[2])-Math.max(e[0],t[0]);return r<0||n<0?0:r*n}function c(e,t){var r=s(e,t);return(e[3]-e[1])*(e[2]-e[0])+(t[3]-t[1])*(t[2]-t[0])-r}function l(e,t){return s(e,t)/c(e,t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.downloadModel=void 0;var n,o,a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=(t.downloadModel=(n=l(regeneratorRuntime.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.loadModel(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)}),function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(1))),u=r(2),s=r(0),c=(o=s)&&o.__esModule?o:{default:o};function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,a){try{var i=t[o](a),u=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}var f="https://raw.githubusercontent.com/MikeShi42/yolo-tiny-tfjs/master/model2.json";t.default=function(){var e=l(regeneratorRuntime.mark(function e(t,r){var n,o,s,l,f,p,d,h,b,v,m,y,x,g,_,w,k,M,O,j,P,R,S,q,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.4,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.4,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.01;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.tidy(function(){var e=r.predict(t),n=(0,u.yolo_head)(e,u.YOLO_ANCHORS,80),o=a(n,4),i=o[0],s=o[1],c=o[2],l=o[3];return[(0,u.yolo_boxes_to_corners)(i,s),c,l]}),o=a(n,3),s=o[0],l=o[1],f=o[2],e.next=3,(0,u.yolo_filter_boxes)(s,l,f,N);case 3:if(p=e.sent,d=a(p,3),h=d[0],b=d[1],v=d[2],null!=h){e.next=10;break}return e.abrupt("return",[]);case 10:return m=i.scalar(416),y=i.scalar(416),x=i.stack([y,m,y,m]).reshape([1,4]),h=i.mul(h,x),e.next=16,Promise.all([h.data(),b.data()]);case 16:return g=e.sent,_=a(g,2),w=_[0],k=_[1],M=(0,u.non_max_suppression)(w,k,E),O=a(M,3),j=O[0],P=O[1],R=O[2],e.next=23,v.gather(i.tensor1d(j)).data();case 23:return S=e.sent,q=[],S.forEach(function(e,t){var r=R[t];if(!(r<A)){var n=c.default[e],o=a(P[t],4),i=o[0],u=o[1],s=o[2],l=o[3];i=Math.max(0,i),u=Math.max(0,u);var f={className:n,classProb:r,bottom:s=Math.min(416,s),top:i,left:u,right:l=Math.min(416,l)};q.push(f)}}),e.abrupt("return",q);case 27:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){e.exports=r(3)}])});